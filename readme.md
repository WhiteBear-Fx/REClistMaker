# Smooth Recording List Generator

[简体中文](./doc/readme_zh.md)

## Introduction

This is a simple program written in Python that generates smooth CVVC or VCV recording lists. Currently, it only supports command-line usage.

## How to Use

The program uses a dictionary in `.toml` format to generate a `recording list` and an `oto.ini` template. It can also perform conversions between `.toml` and `presamp.ini`.

The following sections describe the dictionary format and available program parameters.

### Symbol Table

- **S**: Syllable, a complete phonetic symbol, e.g., "da".
- **L**: Left vowel (Left component), the consonant part in CVVC, e.g., the left component of "da" is "d".
- **R**: Right vowel (Right component), the vowel part in CVVC, e.g., the right component of "da" is "a".

**Special phonemes, such as trailing breath, glottal stops, etc., should not be considered as any vowel.**

### Dictionary

The program defines syllables and basic behaviors using a TOML file. The format is as follows:

```toml
version = "1.0.0"

[syl]
da = ["d", "a"]
ta = ["t", "a"]
# ... more syllable definitions

[config]
n_fade = ["k", "t", "p", "ch"]
end_flag = true
```

#### Field Descriptions

- **`version`** (Required)  
  The version number of the configuration file format. Must be greater than or equal to `"1.0.0"` (values greater than `1.0.0` have no practical significance).

- **`[syl]`** (Required)  
  Syllable mapping table. Each entry follows the format `S = ["L", "R"]`.  
  For example, `da = ["d", "a"]` means the syllable `da` has a left vowel (L) of `d` and a right vowel (R) of `a`.  
  The program will automatically generate vowel and consonant tables based on all syllables provided.

- **`[config]`** (Optional)  
  Additional options controlling the generation behavior, containing the following fields:

  - **`n_fade`** (Array, Optional)  
    A list of consonant groups that need **disabled** crossfading.  
    Corresponds to `crossfade flag = 1` in the `[CONSONANT]` section of `presamp.ini` (meaning no crossfade).  
    Typically, plosives (like `k`, `t`, `p`, `ch`) need crossfade disabled, while other consonants have it enabled by default (`=0`).

  - **`end_flag`** (Boolean, Optional, default `true`)  
    Determines whether to automatically add an ending phoneme (e.g., `R`) for rests/silences.  
    Corresponds to the `[ENDFLAG]` function in `presamp.ini`. `true` means enabled.

Other configurations in `presamp.ini` (such as vowel and consonant tables) are automatically derived by the program from `[syl]`.

**Please note that any configuration items not mentioned here will be lost after conversion.**

## Command Line Reference

Version: 0.0.1

### Global Options

- **`-v, --version`**  
  Display the program version number and exit.

- **`-h, --help`**  
  Display help information (automatically generated by argparse).

### Command Overview

The program performs different operations through subcommands. Three commands are currently supported: `generate` (alias `gen`), `from_presamp` (alias `fp`), and `to_presamp` (alias `tp`). A subcommand must be specified when using the program.

---

#### `generate` command (alias `gen`)

**Purpose**: Generate recording list files (e.g., `.txt`), `oto.ini` template, and `presamp.ini` based on a syllable dictionary.

The recording list consists of several lines, each containing a sequence of syllables (e.g., S1, S2, S3). Based on the user-provided set of syllables (each defined by a left vowel L and right vowel R) and the selected mode (CVVC or VCV), the program generates a table covering all necessary transitional components, while also making adjacent syllables within each line as "smooth" as possible. Smoothness is categorized as either perfectly smooth (adjacent syllables share a left or right vowel) or cyclically alternating smooth (categories repeat according to a fixed cycle). The program constructs line sequences using search algorithms; the following parameters control the search behavior.

- **`-i, --input`** (Required)  
  Path to the input syllable dictionary file in TOML format.

- **`-o, --output`** (Optional)  
  Path for output files (without filename). The program will generate: `<output_path>/REClist.txt`, `<output_path>/oto.ini`, and `<output_path>/presamp.ini`. If not specified, it is automatically generated based on the input filename.

- **`-m, --mode`** (Optional, default `CVVC`)  
  Select the generation mode, either `VCV` or `CVVC`.

- **`-b, --bpm`** (Optional, default `120`)  
  The speed (BPM) of the background music for recording, used to generate rhythm references.

- **`-l, --max-length`** (Optional, default `6`)  
  The maximum number of syllables per line, ranging from 2 to 8, used for formatting the recording list.

- **`-s, --SSS-first`** (Optional, flag)  
  Prioritize using the "Three Consecutive Repeat Syllable" pattern for arrangement, i.e., prioritize constructing sequences of three identical syllables. This pattern usually has higher pronounceability.

- **`-d, --iter-depth`** (Optional)  
  Maximum iteration depth when searching for the optimal arrangement order. Increasing this value may find smoother arrangements but will increase computation time. The default and maximum values are half of the `-l` value.

- **`-r, --max-redundancy`** (Optional, default `50`)  
  The maximum number of redundant syllables allowed to be added to improve smoothness. A higher value allows the program to insert more extra syllables to optimize smoothness, but will also increase the length of the recording list accordingly.

---

#### `from_presamp` command (alias `fp`)

**Purpose**: Convert an existing `presamp.ini` configuration file into the TOML syllable dictionary format used by the program, making it easy to edit or regenerate the recording list.

- **`-i, --input`** (Required)  
  Path to the input `presamp.ini` file.

- **`-o, --output`** (Optional)  
  Path for the output TOML file (without filename). If not specified, a file with the same name but a `.toml` extension is generated in the same directory as the input file.

---

#### `to_presamp` command (alias `tp`)

**Purpose**: Convert a TOML syllable dictionary file used by the program into a `presamp.ini` configuration file for compatibility with existing UTAU toolchains (e.g., `autocvvc.exe`).

- **`-i, --input`** (Required)  
  Path to the input TOML syllable dictionary file.

- **`-o, --output`** (Optional)  
  Path for the output `presamp.ini` file (without filename). If not specified, `presamp.ini` is generated in the same directory as the input file.
