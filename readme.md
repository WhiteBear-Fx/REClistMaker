# Smooth Recording List Generator

English | [简体中文](./doc/readme_zh.md)

## Introduction

This is a simple program written in Python that generates smooth CVVC or VCV recording lists. Currently, it only supports command-line usage.

## How to Use

The program generates a `recording list` and `oto.ini` template using a dictionary in `.toml` format. It can also convert between `.toml` and `presamp.ini` formats.

Below is an introduction to the dictionary format and available program parameters.

### Symbol Table

- **S**: Syllable, a complete pronunciation symbol, e.g., "da".
- **L**: Left vowel, the consonant part of CVVC, e.g., the left vowel of "da" is "d".
- **R**: Right vowel, the vowel part of CVVC, e.g., the right vowel of "da" is "a".

**Special phonemes, such as breath sounds or glottal stops, should not be treated as vowels.**

### Dictionary

The program defines syllables and basic behaviors using a TOML file. The format is as follows:

```toml
version = "1.0.0"

[syl]
da = ["d", "a"]
ta = ["t", "a"]
# ... more syllable definitions

[config]
n_fade = ["k", "t", "p", "ch"]
end_flag = true
```

#### Field Descriptions

- **`version`** (required)  
  The version number of the configuration file format. Currently, it must be greater than or equal to `"1.0.0"` (values greater than `1.0.0` have no practical significance).

- **`[syl]`** (required)  
  The syllable mapping table. Each entry follows the format `S = ["L", "R"]`.  
  For example, `da = ["d", "a"]` means the left vowel (L) of the syllable `da` is `d`, and the right vowel (R) is `a`.  
  The program automatically generates vowel and consonant tables based on all provided syllables.

- **`[config]`** (optional)  
  Additional options controlling the generation behavior, including the following fields:

  - **`n_fade`** (array, optional)  
    A list of consonant groups for which **crossfading should be disabled**.  
    Corresponds to the `crossfade flag = 1` in `[CONSONANT]` in `presamp.ini` (meaning no crossfade).  
    Typically, plosives (e.g., `k`, `t`, `p`, `ch`) require disabled crossfading, while other consonants have crossfading enabled by default (`=0`).

  - **`end_flag`** (boolean, optional, default `true`)  
    Determines whether to automatically add ending phonemes (e.g., `R`) for rests.  
    Corresponds to the `[ENDFLAG]` functionality in `presamp.ini`. `true` means enabled.

Other configurations in `presamp.ini` (such as vowel and consonant tables) are automatically derived from `[syl]`.

**Please note that any configuration items not mentioned here will be lost after conversion.**

## Command Line Reference

Version: 0.0.1

### Global Options

- **`-v, --version`**  
  Display the program version and exit.

- **`-h, --help`**  
  Display help information (automatically generated by argparse).

### Command Overview

The program performs different operations through subcommands. Currently, three commands are supported: `generate` (alias `gen`), `from_presamp` (alias `fp`), and `to_presamp` (alias `tp`). A subcommand must be specified when using the program.

---

#### `generate` Command (alias `gen`)

**Purpose**: Generate a recording list file (e.g., `.txt`), an `oto.ini` template, and `presamp.ini` based on the syllable dictionary.

The recording list consists of multiple lines, each containing a sequence of syllables (e.g., S1, S2, S3). The program uses the user-provided syllable set (each syllable defined by left vowel L and right vowel R) and the selected mode (CVVC or VCV) to generate a table covering all necessary transitional components. It also aims to make adjacent syllables in each line as "smooth" as possible. Smoothness is categorized as fully smooth (adjacent syllables share left or right vowels) or periodically alternating smoothness (repeating categories at fixed intervals). The program constructs line sequences using a search algorithm, and the following parameters can control the search behavior.

- **`-i, --input`** (required)  
  Path to the input TOML-format syllable dictionary file.

- **`-o, --output`** (optional)  
  Path for output files (excluding filenames). The program generates: `<output_path>/REClist.txt`, `<output_path>/oto.ini`, and `<output_path>/presamp.ini`. If not specified, it is automatically generated based on the input filename.

- **`-m, --mode`** (optional, default `CVVC`)  
  Select the generation mode. Options: `VCV`, `CVVC`, or `VCV_WITH_VC`.

- **`-b, --bpm`** (optional, default `120`)  
  The tempo (BPM) of the background music for recording, used to generate the `oto.ini` template.

- **`-l, --max-length`** (optional, default `6`)  
  The maximum number of syllables per line. Range: 2 to 8.

- **`-s, --SSS-first`** (optional, flag)  
  Prioritize using triple-syllable repetition patterns, such as sequences like `da_da_da`, where the third syllable can be lengthened for use as a long vowel suffix (`L` suffix).

- **`-d, --iter-depth`** (optional)  
  The maximum iteration depth when searching for the optimal arrangement order. Increasing this value increases computation time and may not necessarily improve smoothness. The default and maximum values are half of the `-l` parameter.

- **`-r, --max-redundancy`** (optional, default `50`)  
  The maximum number of redundant syllables allowed to improve smoothness.

---

#### `from_presamp` Command (alias `fp`)

**Purpose**: Convert an existing `presamp.ini` configuration file into the program's TOML syllable dictionary format for easier editing or regenerating recording lists.

- **`-i, --input`** (required)  
  Path to the input `presamp.ini` file.

- **`-o, --output`** (optional)  
  Path for the output TOML file (excluding filename). If not specified, a file with the same name but a `.toml` extension is generated in the same directory as the input file.

---

#### `to_presamp` Command (alias `tp`)

**Purpose**: Convert the program's TOML syllable dictionary file into a `presamp.ini` configuration file for compatibility with existing UTAU toolchains (e.g., `autocvvc.exe`).

- **`-i, --input`** (required)  
  Path to the input TOML syllable dictionary file.

- **`-o, --output`** (optional)  
  Path for the output `presamp.ini` file (excluding filename). If not specified, `presamp.ini` is generated in the same directory as the input file.